name: github-actions-c

on:
  pull_request:
    branches: ['*']
  push:
    branches: [master]
jobs:
  Archlinux:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Starts docker-compose
        run: DISTRO=archlinux docker-compose up -d
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 RELEASE=1 ./scripts/build-docker.sh
  CentOS:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Starts docker-compose
        run: DISTRO=centos docker-compose up -d
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 COMPILE_ONLY=1 RELEASE=1 ./scripts/build-docker.sh
  Debian:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Starts docker-compose
        run: DISTRO=debian docker-compose up -d
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 RELEASE=1 ./scripts/build-docker.sh
  Fedora:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Starts docker-compose
        run: DISTRO=fedora docker-compose up -d
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 RELEASE=1 ./scripts/build-docker.sh
  Ubuntu:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Starts docker-compose
        run: DISTRO=ubuntu docker-compose up -d
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 RELEASE=1 ./scripts/build-docker.sh
  UbuntuLTS:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Starts docker-compose
        run: DISTRO=ubuntu-lts docker-compose up -d
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 RELEASE=1 ./scripts/build-docker.sh
  UnixSocket:
    runs-on: ubuntu-latest
    steps:
      - name: Checks out the repository
        uses: actions/checkout@v2
      - name: Installs MariaDB
        run:  apt-get install mariadb-server
      - name: Sleep
        uses: jakejarvis/wait-action@master
        with:
          time: '20s'
      - name: Build and test
        run: CI=1 CONFIG_FILE=libnss-maria.conf EXAMPLE_SET=unix_socket RELEASE=1 ./scripts/compile_and_test.sh
